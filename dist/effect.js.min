"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Action=void 0;var _Types=require("./Types.js"),ActionProto={toString:function(){var e=this.type,t=this.data,r=(0,_Types.typeName)(e);if(t){var n=t.action;if(n)return"Action("+r+", "+String(t.action)+")";var f=String(t);return"[object Object]"===f&&(f=JSON.stringify(t)),"Action("+r+", "+f+")"}return"Action("+r+")"}},Action=exports.Action=function(e,t){var r=Object.create(ActionProto);return Object.assign(r,{type:e,data:t})},wrap=function(e,t){return function(r){return Action(e,Object.assign(t||{},{action:r}))}},unwrap=function(e){var t=e.data.action;return t};Action.wrap=wrap,Action.unwrap=unwrap;var _slicedToArray=function(){function e(e,t){var r=[],n=!0,f=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(s){f=!0,o=s}finally{try{!n&&c["return"]&&c["return"]()}finally{if(f)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Effect=exports.effectTypes=void 0;var _Types=require("./Types.js"),_perform=require("./perform.js"),SideEffect=Symbol("SideEffect"),effectTypes=exports.effectTypes=(0,_Types.Types)("none","call","then","all"),call=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var f=effectTypes.call,o={fn:e,args:r};return Effect(f,o)},EffectProto={then:function(e){this.type,this.data;return Effect(effectTypes.then,{effect:this,callback:e})},map:function(e){return this.type===effectTypes.none?Effect.none:this.then(function(t){return call(e,t)})},stringify:function(){var e=arguments.length<=0||void 0===arguments[0]?"  ":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=this.type,n=this.data,f=(0,_Types.typeName)(r);if(r===effectTypes.none)return"[Effect "+f+"]";if(r===effectTypes.call){var o=n.fn,i=n.args,c=o.name||"fn",s=i.map(function(t){return e+String(t)}).join(",\n");return[f+"(",e+c,s,t+")"].join("\n")}if(r===effectTypes.then){var a=n.effect,u=n.callback,c=u.name||"fn",p=a.stringify("  "+e,e);return[f+"(",e+p,e+c,t+")"].join("\n")}if(r===effectTypes.all){var l=n.effects,y=l.map(function(t){return e+t.stringify("  "+e,e)}).join(",\n");return[f+"([",y,t+"])"].join("\n")}return f+"("+JSON.stringify(n)+")"},toString:function(){return this.stringify()}},Effect=exports.Effect=function(e,t){var r,n=Object.create(EffectProto);return Object.assign(n,(r={},_defineProperty(r,SideEffect,!0),_defineProperty(r,"type",e),_defineProperty(r,"data",t),r))};Effect.call=call;var none=Effect(effectTypes.none);Effect.none=none;var seq=function e(t){var r=function(e){return e},n=function(e){return e.map(r)},f=n(t),o=f.shift();return 0===f.length?o:Effect(effectTypes.then,{effect:o,callback:function(){return e(f)}})};Effect.seq=seq;var all=function(e){if(!Array.isArray(e))throw new Error("Need to pass array to Effect.all, got: "+JSON.stringify(e));if(0===e.length)return Effect.none;if(1===e.length){var t=_slicedToArray(e,1),r=t[0];return r.map(function(e){return[e]})}return Effect(effectTypes.all,{effects:e})};Effect.all=all,Object.defineProperty(exports,"__esModule",{value:!0}),exports.Result=exports.ResultSymbol=void 0;var _Effect=require("./Effect.js"),ResultSymbol=exports.ResultSymbol=Symbol("result"),ResultProto={toString:function(){var e=this.state,t=this.effect;return t.type===_Effect.effectTypes.none?"Result("+JSON.stringify(e)+")":"Result(\n  "+JSON.stringify(e)+",\n  "+t.stringify("    ","  ")+"\n)"}},Result=exports.Result=function(e){var t=arguments.length<=1||void 0===arguments[1]?_Effect.Effect.none:arguments[1],r=Object.create(ResultProto);return Object.assign(r,_defineProperty({state:e,effect:t},ResultSymbol,!0))};Object.defineProperty(exports,"__esModule",{value:!0});var typeName=exports.typeName=function(e){return"symbol"===("undefined"==typeof e?"undefined":_typeof(e))?Symbol.keyFor(e):String(e)},Types=exports.Types=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return t.reduce(function(e,t){return e[t]=Symbol["for"](t),e},{})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Action=exports.Result=exports.Types=exports.Effect=void 0;var _zenObservable=require("zen-observable"),_zenObservable2=_interopRequireDefault(_zenObservable),_Effect=require("./Effect.js"),_Types=require("./Types.js"),_Result=require("./Result.js"),_Action=require("./Action.js"),_perform=require("./perform.js");exports.Effect=_Effect.Effect,exports.Types=_Types.Types,exports.Result=_Result.Result,exports.Action=_Action.Action;var noop=function(){},app=function(e){var t={view:noop},r=Object.assign(t,e),n=r.init,f=r.update,o=r.view,i=r.performer,c=(0,_perform.performWith)(i),s=void 0,a=new _zenObservable2["default"](function(e){s=e.next.bind(e)}),u=function(e){c(e).then(function(e){e.forEach(s)})["catch"](function(e){console.error(e.stack)})},p=n(),l=p.state,y=p.effect;return o(l),u(y),a.forEach(function(e){var t=e.type,r=f(l,e);if(!r||!r[_Result.ResultSymbol])throw new Error("Unhandled action type "+(0,_Types.typeName)(t)+" for action "+String(e));var n=r.state,i=r.effect;l=n,i.type!==_Effect.effectTypes.none&&u(i),o(l)})["catch"](function(e){console.error(e),console.error(e.stack)}),{next:s}};_Effect.Effect.app=app,Object.defineProperty(exports,"__esModule",{value:!0}),exports.performWith=exports.perform=void 0;var _Effect=require("./Effect.js"),_Types=require("./Types.js"),flatten=function(e){return 0===e.length?e:e.reduce(function(e,t){return t.forEach(function(t){return e.push(t)}),e},[])},perform=exports.perform=function(e){return performWith({})},performWith=exports.performWith=function t(e){return function(r){var n=t(e),f=r.type,o=r.data;return new Promise(function(t,i){if(f===_Effect.effectTypes.none)t([]);else if(f===_Effect.effectTypes.call){var c=o.fn,s=o.args,a=Promise.resolve(c.apply(c,s)).then(function(e){return[e]});t(a)}else if(f===_Effect.effectTypes.then)!function(){var e=o.effect,r=o.callback;o.testing;t(n(e).then(function(e){if(0===e.length)return Promise.resolve([]);if(e.length>1){var t=r(e);return n(t)}if(1===e.length){var f=e[0],o=r(f);return n(o)}throw new Error("Should not be able to enter here")}))}();else if(f===_Effect.effectTypes.all){var u=o.effects,p=u.filter(function(e){return e.type!==_Effect.effectTypes.none});t(0===p.length?[]:Promise.all(p.map(n)).then(flatten))}else{var l=e.matcher(r);if(l){var a=Promise.resolve(l(r)).then(function(e){return Array.isArray(e)?e:[e]});t(a)}else{var y=(0,_Types.typeName)(f);i(new Error("No performer for type "+y+", "+String(r)))}}}).then(function(e){return e})}};
//# sourceMappingURL=dist/effect.js.min.map