"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Action=void 0;var _Types=require("./Types.js"),ActionProto={toString:function(){var e=this.type,t=this.data,r=(0,_Types.typeName)(e);if(t){var n=t.action;if(n)return"Action("+r+", "+String(t.action)+")";var f=String(t);return"[object Object]"===f&&(f=JSON.stringify(t)),"Action("+r+", "+f+")"}return"Action("+r+")"}},Action=exports.Action=function(e,t){var r=Object.create(ActionProto);return Object.assign(r,{type:e,data:t})},wrap=function(e,t){return function(r){return Action(e,Object.assign(t||{},{action:r}))}},unwrap=function(e){var t=e.data.action;return t};Action.wrap=wrap,Action.unwrap=unwrap;var _slicedToArray=function(){function e(e,t){var r=[],n=!0,f=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(c){f=!0,o=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(f)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Effect=exports.effectTypes=exports.SideEffect=void 0;var _Types=require("./Types.js"),_perform=require("./perform.js"),SideEffect=exports.SideEffect=Symbol("SideEffect"),effectTypes=exports.effectTypes=(0,_Types.Types)("none","call","then","all"),call=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var f=effectTypes.call,o={fn:e,args:r};return Effect(f,o)},EffectProto={then:function(e){this.type,this.data;return Effect(effectTypes.then,{effect:this,callback:e})},map:function(e){return this.type===effectTypes.none?Effect.none:this.then(function(t){return call(e,t)})},stringify:function(){var e=arguments.length<=0||void 0===arguments[0]?"  ":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=this.type,n=this.data,f=(0,_Types.typeName)(r);if(r===effectTypes.none)return"[Effect "+f+"]";if(r===effectTypes.call){var o=n.fn,i=n.args,a=o.name||"fn",c=i.map(function(t){return e+String(t)}).join(",\n");return[f+"(",e+a,c,t+")"].join("\n")}if(r===effectTypes.then){var s=n.effect,u=n.callback,a=u.name||"fn",p=s.stringify("  "+e,e);return[f+"(",e+p,e+a,t+")"].join("\n")}if(r===effectTypes.all){var l=n.effects,y=l.map(function(t){return e+t.stringify("  "+e,e)}).join(",\n");return[f+"([",y,t+"])"].join("\n")}return f+"("+JSON.stringify(n)+")"},toString:function(){return this.stringify()}},Effect=exports.Effect=function(e,t){var r,n=Object.create(EffectProto);return Object.assign(n,(r={},_defineProperty(r,SideEffect,!0),_defineProperty(r,"type",e),_defineProperty(r,"data",t),r))};Effect.types=effectTypes,Effect.call=call;var none=Effect(effectTypes.none);Effect.none=none;var seq=function e(t){var r=function(e){return e},n=function(e){return e.map(r)},f=n(t),o=f.shift();return 0===f.length?o:Effect(effectTypes.then,{effect:o,callback:function(){return e(f)}})};Effect.seq=seq;var all=function(e){if(!Array.isArray(e))throw new Error("Need to pass array to Effect.all, got: "+JSON.stringify(e));if(0===e.length)return Effect.none;if(1===e.length){var t=_slicedToArray(e,1),r=t[0];return r.map(function(e){return[e]})}return Effect(effectTypes.all,{effects:e})};Effect.all=all,Object.defineProperty(exports,"__esModule",{value:!0}),exports.Result=exports.ResultSymbol=void 0;var _Effect=require("./Effect.js"),ResultSymbol=exports.ResultSymbol=Symbol("result"),ResultProto={toString:function(){var e=this.state,t=this.effect;return t.type===_Effect.effectTypes.none?"Result("+JSON.stringify(e)+")":"Result(\n  "+JSON.stringify(e)+",\n  "+t.stringify("    ","  ")+"\n)"}},Result=exports.Result=function(e){var t=arguments.length<=1||void 0===arguments[1]?_Effect.Effect.none:arguments[1],r=Object.create(ResultProto);return Object.assign(r,_defineProperty({state:e,effect:t},ResultSymbol,!0))};Object.defineProperty(exports,"__esModule",{value:!0});var typeName=exports.typeName=function(e){return"symbol"===("undefined"==typeof e?"undefined":_typeof(e))?Symbol.keyFor(e):String(e)},Types=exports.Types=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return t.reduce(function(e,t){return e[t]=Symbol["for"](t),e},{})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.testEffects=exports.performWith=exports.testPerformer=exports.basePerformer=exports.SideEffect=exports.Action=exports.Result=exports.Types=exports.Effect=void 0;var _zenObservable=require("zen-observable"),_zenObservable2=_interopRequireDefault(_zenObservable),_Effect=require("./Effect.js"),_Types=require("./Types.js"),_Result=require("./Result.js"),_Action=require("./Action.js"),_perform=require("./perform.js"),_test=require("./test.js");exports.Effect=_Effect.Effect,exports.Types=_Types.Types,exports.Result=_Result.Result,exports.Action=_Action.Action,exports.SideEffect=_Effect.SideEffect,exports.basePerformer=_perform.basePerformer,exports.testPerformer=_perform.testPerformer,exports.performWith=_perform.performWith,exports.testEffects=_test.testEffects;var noop=function(){},app=function(e){var t={view:noop},r=Object.assign(t,e),n=r.init,f=r.update,o=r.view,i=r.performer,a=(0,_perform.basePerformer)(),c=Object.assign({},a,i),s=(0,_perform.performWith)(c),u=void 0,p=new _zenObservable2["default"](function(e){u=e.next.bind(e)}),l=function(e){s(e).then(function(e){e.forEach(u)})["catch"](function(e){console.error(e.stack)})},y=n(),d=y.state,m=y.effect;return o(d),l(m),p.forEach(function(e){var t=e.type,r=f(d,e);if(!r||!r[_Result.ResultSymbol])throw new Error("Unhandled action type "+(0,_Types.typeName)(t)+" for action "+String(e));var n=r.state,i=r.effect;d=n,i.type!==_Effect.effectTypes.none&&l(i),o(d)})["catch"](function(e){console.error(e),console.error(e.stack)}),{next:u}};_Effect.Effect.app=app;var _slicedToArray=function(){function e(e,t){var r=[],n=!0,f=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(c){f=!0,o=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(f)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.performWith=exports.perform=exports.testPerformer=exports.basePerformer=void 0;var _Types=require("./Types.js"),_Effect=require("./Effect.js"),flatten=function(e){return 0===e.length?e:e.reduce(function(e,t){return t.forEach(function(t){return e.push(t)}),e},[])},basePerformer=exports.basePerformer=function(){var e,t=_Effect.effectTypes.call,r=_Effect.effectTypes.none,n=_Effect.effectTypes.then,f=_Effect.effectTypes.all;return e={},_defineProperty(e,r,function(e,t){return[]}),_defineProperty(e,n,function(e,t){var r=e.data,n=r.effect,f=r.callback;r.testing;return t(n).then(function(e){if(0===e.length)return Promise.resolve([]);if(e.length>1){var r=f(e);return t(r)}if(1===e.length){var n=e[0],o=f(n);return t(o)}throw new Error("Should not be able to enter here")})}),_defineProperty(e,f,function(e,t){var r=e.data,n=r.effects,f=n.filter(function(e){return e.type!==_Effect.effectTypes.none});return 0===f.length?[]:Promise.all(f.map(t)).then(flatten)}),_defineProperty(e,t,function(e){var t=e.data,r=t.fn,n=t.args;return Promise.resolve(r.apply(r,n)).then(function(e){return[e]})}),e},testPerformer=exports.testPerformer=function t(e,r){var n,f=_Effect.effectTypes.call,o=_Effect.effectTypes.none,i=_Effect.effectTypes.then,a=_Effect.effectTypes.all;return n={},_defineProperty(n,o,function(t){r.equal(e.type,o)}),_defineProperty(n,i,function(n){r.equal(e.type,i);var f=e.data.effect,o=performWith(t(f,r)),a=n.data,c=a.effect,s=(a.testing,e.data.callback);return Promise.all([o(c),o(f)]).then(function(e){var n=_slicedToArray(e,2),f=n[0],o=n[1];if(0===f.length)return[];if(f.length>1){var i=s(o),a=performWith(t(i,r)),c=s(f);return a(c)}if(1===f.length){var u=s(o[0]),p=performWith(t(u,r)),l=f[0],y=s(l);return p(y)}throw new Error("Should not be able to enter here")})}),_defineProperty(n,a,function(n){r.equal(e.type,a);var f=n.data,o=f.effects,i=e.data.effects;return Promise.all(o.map(function(e,n){var f=i[n],o=performWith(t(f,r));return o(e)})).then(flatten)}),_defineProperty(n,f,function(t){var r=t.data,n=r.args,f=e.data.fn;return Promise.resolve(f.apply(f,n)).then(function(e){return[e]})}),n},perform=exports.perform=function(e){return performWith(basePerformer)},performWith=exports.performWith=function r(e){return function(t){var n=r(e),f=t.type,o=(t.data,e[f]);return Promise.resolve().then(function(){if(o)return Promise.resolve(o(t,n)).then(function(e){return Array.isArray(e)?e:[e]});var e=(0,_Types.typeName)(f);throw new Error("No performer for type "+e+", "+String(t))})}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.testEffects=void 0;var _=require(".."),effectEqual=function(e,t,r){e(t[_.SideEffect],String(t)),e(r[_.SideEffect]),e.equal(t.type,r.type);var n=(0,_.testPerformer)(r,e),f=(0,_.performWith)(n);return f(t)},testEffects=exports.testEffects=function(e,t){return function(r){var n=r.action,f=r.state,o=r.expected,i=o.state,a=o.effect,c=void 0===a?_.Effect.none:a,s=o.actions,u=void 0===s?[]:s,p=e(f,n),l=p.state,y=p.effect;return t.equal(l,i),effectEqual(t,y,c).then(function(e){e.map(function(e,r){t.equal(String(e),String(u[r]))})})}};
//# sourceMappingURL=dist/effect.js.min.map